# Scenario 1
> Let's assume well-known PowerShell offensive Frameworks and Scripts/Commands are executed in the environment.  

## Hunting
> To hunt for this focus only on the available PowerShell _ScriptBlockText_ field and EventID 4104

## Table
> The below ELK query detects suspicious activity.    

| Query | Description |
| ----- | ----------- |
|winlog.event_id:4104| Filter for the the powershell | 
|winlog.event_data.ScriptBlockText:(PowerUp OR Mimikatz OR NinjaCopy OR Get-ModifiablePath OR AllChecks OR AmsiBypass OR PsUACme OR Invoke-DLLInjection OR Invoke-ReflectivePEInjection OR Invoke-Shellcode OR Get-GPPPassword OR Get-Keystrokes OR Get-TimedScreenshot OR PowerView) | Powershell framework or scripts/commands |   

# Scenario 2
> Hunt for suspicious parent process spawning PowerShell
>> Adversaries utilise the system's well-known or internal process to spawn the PowerShell to hide under the hood.  

## Hunting 
> To hunt for the suspicious process, leverage Sysmon events related to the process creation (EventID 1)

## Table
> The below ELK query detects suspicious activity.

| Query | Description |
| ----- | ----------- |
| winlog.event_data.ParentImage:(*mshta.exe OR *rundll32.exe OR *regsvr32.exe OR *services.exe OR *winword.exe OR *wmiprvse.exe OR *powerpnt.exe OR *excel.exe OR *msaccess.exe OR *mpub.exe OR *visio.exe OR *outlook.exe OR *chrome.exe OR *iexplorer.exe OR *sqlserver.exe) AND winlog.event_data.Image : *powershell.exe | This query is likely trying to find instances where PowerShell is spawned by specific parent processes |

# Scenario 3
> Hunt for renamed PowerShell.exe
>> The attacker uses this method to disguise the system functionality to execute malicious executables.  

## Hunting 
> The fact that the PowerShell executable preserves "PowerShell" in its description, regardless of the name.
>> To hunt for the "renamed" activity, look into Sysmon events related to the process creation (EventID 1)

## Table
> The following ELK query detects the activity.

| Query | Description |
| ----- | ----------- |
|winlog.event_data.Description:*PowerShell AND NOT (winlog.event_data.Image:*powershell.exe OR winlog.event_data.Image:*powershell_ise.exe) | This query is likely to get renamed executable that is not powershell.exe or powershell_ise.exe | 
|winlog.event_id:400 AND HostNmae=ConsoleHost AND NOT HostApplication=*powershell.exe| Detects the renamed activity | 
















